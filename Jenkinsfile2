pipeline {
  agent any

  environment {
    // Must match the name in Manage Jenkins ‚Üí Configure System ‚Üí Jira
    JIRA_SITE  = 'jira-rest-api'
    // We‚Äôll populate this if/when we create a Jira issue
    ISSUE_KEY  = ''
  }

  stages {

    // ‚Ä¶ your Jira / Docker stages go here, un-commented if you want them ‚Ä¶

  }

  post {
    always {
      echo "üì¶ Archiving JMeter outputs‚Ä¶"
      archiveArtifacts artifacts: 'results.jtl, jmeter.log', fingerprint: true
    }
    success {
      echo "üìä Publishing JMeter HTML report‚Ä¶"
      publishHTML([
        reportDir:    "reports/jmeter-${env.BUILD_NUMBER}",
        reportFiles:  'index.html',
        reportName:   'JMeter HTML Report',
        keepAll:      true,
        alwaysLinkToLastBuild: true
      ])
    }
    failure {
      script {
        if (env.ISSUE_KEY) {
          echo "üí• Notifying Jira of failure‚Ä¶"
          jiraAddComment(
            site:      env.JIRA_SITE,
            idOrKey:   env.ISSUE_KEY,
            comment:   "‚ö†Ô∏è Build #${env.BUILD_NUMBER} FAILED: ${env.BUILD_URL}"
          )
        }
      }
    }
  }

}
